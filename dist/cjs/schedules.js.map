{"version":3,"file":"schedules.js","names":["_holiday","require","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty2","default","getOwnPropertyDescriptors","defineProperties","defineProperty","Schedules","exports","schedules","currentDate","admin","undefined","_classCallCheck2","date","Date","holiday","Holiday","getFullYear","listHoliday","getHoliday","listOtherHoliday","getOtherHoliday","listAdmins","getAdmins","_createClass2","key","value","getPreview","size","weekData","Array","preview","setHours","index","month","getMonth","day","getDate","dayWeek","getDay","type","strDate","concat","times","setDate","isOpen","currentType","isFr","split","i","_schedule$period$star","_schedule$period$end","schedule","scheduleType","period","repeat","periodStart","start","periodEnd","end","months","includes","days","some","dayId","time","open","scheduleIsOpen","hour","getHours","minute","getMinutes","strHour","concatWeek","week","_this","prevHash","prevKey","prevTime","listDays","dayKey","hash","JSON","stringify","endArray","notSame","notAllDay","concatMonths","_this2","prevWeek","listMonths","monthKey","concatPeriods","periods","ctx","map","_periods$key","sortWeek","_this3","dayIndex","weekDay","result","getConcat","_this4","globalWeek","fill","_periods$period","monthIndex","_schedule$period","global"],"sources":["../../src/schedules.ts"],"sourcesContent":["import { Holiday } from \"./holiday\";\n\nexport interface Schedule {\n  days: Array<number>;\n  months: Array<number>;\n  period: { start: string | null, end: string | null, repeat: boolean | null },\n  time: { open: number, start: string | null, end: string | null },\n  type: number,\n}\n\nexport class Schedules {\n\n  private listHoliday: Array<String> = [];\n  private listOtherHoliday: Array<String> = [];\n  private listAdmins: Array<String> = [];\n\n  private schedules: Array<Schedule> = [];\n  private admin: string | null = null;\n\n  private date: Date;\n\n  private dayIndex: Array<number> = [6, 0, 1, 2, 3, 4, 5, 7];\n  private dayKey: Array<number> = [1, 2, 3, 4, 5, 6, 0, 7];\n  \n  private monthIndex: Array<number> = [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];\n  private monthKey: Array<number> = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12];\n\n  constructor(schedules: Array<Schedule>, currentDate: string, admin: string | null = null) {\n    this.schedules = schedules;\n    this.date = new Date(currentDate);\n    this.admin = admin;\n\n    const holiday = new Holiday(this.date.getFullYear());\n    this.listHoliday = holiday.getHoliday();\n    this.listOtherHoliday = holiday.getOtherHoliday();\n    this.listAdmins = holiday.getAdmins();\n  }\n\n  /**\n    * Retourne l'état actuelle de l'horaires ainsi que la liste des horaires correspondant au jour renseigné\n    * @param {number} size Length of the preview (7 day by default)\n    * @returns {Object}\n    */\n  getPreview(size: number = 7): Object {\n    if (!size) return {};\n\n    const weekData = new Array(size);\n    const preview = new Array(size);\n\n    const date = new Date(this.date);\n    date.setHours(0, 0, 0, 0);\n\n    for (let index = 0; index < size; index++) {\n      const month = date.getMonth() + 1;\n      const day = date.getDate();\n      const dayWeek = date.getDay();\n      weekData[index] = {\n        type: 0,\n        date: new Date(date),\n        strDate: `${month < 10 ? `0${month}` : month}-${day < 10 ? `0${day}` : day}`,\n        month,\n        dayWeek,\n      };     \n      preview[index] = {\n        day: dayWeek,\n        times: [],\n      };\n      date.setDate(date.getDate() + 1);\n    }\n\n    let isOpen = null;\n    let currentType = null;\n\n    const isFr = this.admin ? this.admin.split('-')[0] === 'FR' : false\n    for (let i = 0; i < this.schedules.length; i += 1) {\n      const schedule: Schedule = this.schedules[i];\n\n      let scheduleType = schedule.type === 2 && !schedule.period.repeat ? 10 : schedule.type;\n\n      const periodStart = new Date(schedule.period.start ?? 0);\n      periodStart.setHours(0, 0, 0, 0);\n      const periodEnd = new Date(schedule.period.end ?? 0);\n      periodEnd.setHours(23, 59, 59, 999);\n\n\n      for (let index = 0; index < weekData.length; index++) {\n        // Periods or Months\n        if (schedule.type === 2) {\n          if (weekData[index].date < periodStart || weekData[index].date > periodEnd) {\n            continue;\n          }\n        } else if (schedule.type === 1 && !schedule.months.includes(weekData[index].month)) {\n          continue;\n        }\n\n        // Days\n        if (!schedule.days.includes(weekData[index].dayWeek)) {\n          if (schedule.days.some((dayId) => dayId === 7) && isFr) {\n            if (!this.listHoliday.includes(weekData[index].strDate)) {\n              if (!this.admin || !this.listAdmins.includes(this.admin) || !this.listOtherHoliday.includes(weekData[index].strDate)) {\n                continue;\n              }\n            }\n          } else {\n            continue;\n          }\n        }\n\n        // Time\n        if (scheduleType >= weekData[index].type) {\n          const start = schedule.time.start;\n          const end = schedule.time.end;\n          const open = !!schedule.time.open;\n\n          // Today state\n          let scheduleIsOpen = null;\n          if (index === 0) {\n            const hour = this.date.getHours();\n            const minute = this.date.getMinutes();\n            const strHour = `${hour < 10 ? `0${hour}` : hour}:${minute < 10 ? `0${minute}` : minute}`;\n            if (start && end) {\n                if (start <= strHour && strHour < end){\n                  scheduleIsOpen = open;\n                } else {\n                  scheduleIsOpen = false;\n                }\n            } else {\n              scheduleIsOpen = open;\n            }\n            currentType = schedule.type;\n          }\n\n          // Add or override schedule\n          if (scheduleType === weekData[index].type) {\n            preview[index].times.push({\n              open,\n              start,\n              end\n            });\n            if (index === 0) {\n              isOpen = isOpen ?? scheduleIsOpen;\n            }\n          } else if (scheduleType > weekData[index].type) {\n            weekData[index].type = scheduleType;\n            preview[index].times = [{\n              open,\n              start,\n              end\n            }];\n            if (index === 0) {\n              isOpen = scheduleIsOpen;\n            }\n          }\n        }\n      }\n    }\n\n    return {\n      isOpen,\n      type: currentType,\n      preview,\n    };\n  }\n\n  /**\n   * Consecutive days with the same schedule are grouped \n   * (public holidays are not grouped unless is schedules is the same as the other day of the week)\n   */\n  concatWeek(week: Array<Array<Object> | null> | null): Array<Object> | null {\n    const concatWeek: Array<object> = [];\n    let start: number | null = null;\n    let prevHash: string | null = null;\n    let prevKey: number | null = null;\n    let prevTime: Array<Object> | null = null;\n    let listDays: Array<number> = [];\n\n    week?.forEach((times: any, index) => {\n      const key = this.dayKey[index];\n\n      const hash: string = JSON.stringify(times);\n      const endArray = week.length - 1 === index;\n      const notSame = (prevHash && prevHash !== hash);\n\n      if (start === null) {\n        start = key;\n      } else if (notSame || endArray) {\n        const notAllDay = key === 7 && (notSame || start !== 1);\n        let end: number | null = notSame || notAllDay ? prevKey : key;\n\n        if (!notSame) {\n          listDays.push(key);\n        }\n        \n        concatWeek.push({\n          days: listDays,\n          start,\n          end: end !== start ? end : null,\n          times: prevTime\n        })\n\n        start = key;\n        listDays = [];\n\n        if (notAllDay) {\n          concatWeek.push({\n            days: [start],\n            start,\n            end: null,\n            times,\n          })\n        }\n      } \n\n      prevHash = hash;\n      prevKey = key;\n      prevTime = times;\n      listDays.push(key);\n    })\n\n    return concatWeek.length ? concatWeek : null;\n  }\n\n  /**\n   * Consecutive months with the same schedule are grouped\n   */\n  concatMonths(months: Array<Array<Array<Object> | null>>): Array<Object> {\n    const concatMonths: Array<object> = [];\n    let start: number | null = null;\n    let prevHash: string | null = null;\n    let prevKey: number | null = null;\n    let prevWeek: Array<Array<Object> | null> | null = null;\n    let listMonths: Array<number> = [];\n\n    months.forEach((week: any, index) => {\n      const key = this.monthKey[index];\n      const hash: string = JSON.stringify(week);\n      const endArray = months.length - 1 === index;\n      const notSame = (prevHash && prevHash !== hash);\n\n      if (start === null) {\n        start = key;\n      } else if (notSame || endArray) {\n        const end = notSame ? prevKey : key;\n        if (!notSame) {\n          listMonths.push(key);\n        }\n  \n        concatMonths.push({\n          start,\n          end: end !== start ? end : null,\n          months: listMonths,\n          week: this.concatWeek(prevWeek)\n        })\n\n        start = key;\n        listMonths = [];\n\n        if (notSame && endArray) {\n          concatMonths.push({\n            start,\n            end: null,\n            months: [start],\n            week: this.concatWeek(week)\n          })\n        }\n      } \n\n      prevHash = hash;\n      prevKey = key;\n      prevWeek = week;\n      listMonths.push(key);\n    })\n\n    return concatMonths;\n  }\n\n  /**\n   * Transform periods object in array \n   */\n  concatPeriods(periods: any): Array<Object> {\n    const ctx = this;\n    return Object.keys(periods)\n      .map((key) => {\n        const { start, end, repeat, week } = periods[key];\n        return {\n          start,\n          end: end !== start ? end : null,\n          repeat,\n          week: ctx.concatWeek(week)\n        };\n      });\n  }\n\n  /**\n   * Sort by day\n   * @param {Array} week \n   * @param {Schedule} schedule \n   */\n  sortWeek(week: Array<Array<Object> | null>, schedule: Schedule): void {\n    schedule.days.forEach((day) => {\n      const index = this.dayIndex[day];\n      const weekDay = week[index];\n      const result = { ...schedule.time , open: !!schedule.time.open}\n      if (weekDay) {\n        weekDay.push(result);\n      } else {\n        week[index] = [result];\n      }\n    });\n  }\n\n  /**\n   * @returns All schedules in a concatenated format\n   */\n  getConcat(): Object {\n    const globalWeek = new Array(8).fill(null);\n    const months = new Array(12).fill(null);\n    const periods: any = {};\n\n    this.schedules.forEach((schedule) => {\n      switch (schedule.type) {\n        case 0:\n          this.sortWeek(globalWeek, schedule);\n          break;\n        case 1:\n          // Sort by month\n          schedule.months.forEach((month) => {\n            const index = this.monthIndex[month];\n            let week = months[index];\n            if (!week) {\n              week = new Array(8).fill(null);\n              months[index] = week;\n            }\n            this.sortWeek(week, schedule);\n          });\n          break;\n        case 2:\n          // Sort by periods\n          const {start, end, repeat} = schedule.period;\n          const period = `${repeat}_${start}_${end}`;\n\n          let week = periods[period]?.week;\n          if (!week) {\n            week = new Array(8).fill(null);\n            periods[period] = {\n              start,\n              end,\n              repeat,\n              week\n            };\n          }\n          this.sortWeek(week, schedule);\n          break;\n        default:\n          break;\n      }\n    });\n\n    return {\n      global: this.concatWeek(globalWeek),\n      months: this.concatMonths(months),\n      periods: this.concatPeriods(periods),\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}